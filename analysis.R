#-----------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------
#- Central analysis script for the whole-tree chamber heatwave project.
#-----------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------




#-----------------------------------------------------------------------------------------------------------
#- P R E P A R E
#-----------------------------------------------------------------------------------------------------------

#- Load libraries for analysis. This will install many libraries. Some non-standard libraries many need to
#    be installed manually.
source("R/loadLibraries.R")

#- Download the data. This will place csv files in "/Data"
download_data()
#-----------------------------------------------------------------------------------------------------------



#-----------------------------------------------------------------------------------------------------------
#- F I G U R E   1
#-----------------------------------------------------------------------------------------------------------

#- The photos that make up figure 1 are in /Figure1-site_photos.jpeg
#-----------------------------------------------------------------------------------------------------------



#-----------------------------------------------------------------------------------------------------------
#- F I G U R E   2
#-----------------------------------------------------------------------------------------------------------

#- Run this script to process and plot the whole-tree chamber flux data (Fig. 2)
#    creates a pdf in "Output" named Figure2_fluxes.pdf .
source("R/Figure2_fluxes.R")
#-----------------------------------------------------------------------------------------------------------



#-----------------------------------------------------------------------------------------------------------
#- F I G U R E   3
#-----------------------------------------------------------------------------------------------------------

#- Run this script to process and plot the T50 and temperature data (Fig. 3)
#    creates several pdfs in "Output" named Figure3-X.pdf .
#    Also makes Figure S3 (met and leaf temperature data)
source("R/Figure3_T50_temperatures.R")
#-----------------------------------------------------------------------------------------------------------



#-----------------------------------------------------------------------------------------------------------
#- F I G U R E   4
#-----------------------------------------------------------------------------------------------------------

#- Run this script to do the model evaluation (Figure 4). This takes a few minutes.
#    This generates many error messages where the leaf energy balance had two solutions.
#    For the purpose of this work, these errors can be safely ignored.
#    To generate the supplemental plots for the Leuning and Ball-Berry models (Figs. S8-S9), uncomment and run code
#      at the end of the Figure4-model.R script.
source("R/Figure4_modeling.R")
#-----------------------------------------------------------------------------------------------------------







#-----------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------
#- S U P P L E M E N T A L     T H I N G S
#-----------------------------------------------------------------------------------------------------------
#-----------------------------------------------------------------------------------------------------------



#-----------------------------------------------------------------------------------------------------------
#- F I G U R E S
#-----------------------------------------------------------------------------------------------------------

#- Run this script to plot the TDR measurements of soil water content (Fig. S1)
source("R/plot_VWC_TDR.R")

#- Run this script to plot the neutron probe measurements of soil water content (Fig. S2)
source("R/plot_neutron_probe.R")

#- Run this script to plot leaf water potential and branch and stem hydraulics (Figs. S4-S5)
source("R/plot_midday_LWP.R")

#- Run this script to plot diameter and height increment (Figure S7).
source("R/plot_growth_heatwave.R")
#-----------------------------------------------------------------------------------------------------------